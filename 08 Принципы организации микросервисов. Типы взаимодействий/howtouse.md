# Протокол взаимодействия
1. Запускаем сервисы main, diaglo и БД:
```
docker-compose up -d
```

2. Логинемся под суперпользователем в сервисе main
```
POST http://localhost:18080/login
{
    "id": "root",
    "password": "root"
}
```

3. Добавляем в сервисе main нового пользователя:
```
POST http://localhost:18080/user/register
{
    "user_id": "a216d79c-345e-4ef8-ae80-c06c5f16b2b7"
}
```
Добавляем заголовок "token", в котором указываем токен, полученный в п.2

Ответ, который вернет API запоминаем - это ID добавленного пользователя.

4. Пробуем добавить диалог для пользователя, используя старое API (через сервис main):
```
POST http://localhost:18080/dialog/{user_id}/send
{
    "text": "привет!"
}
```
Добавляем заголовок "token", в котором указываем токен, полученный в п.2. 

Вместо {user_id} подставляем ID добавленного в п 3.

5. Пробуем добавить диалог для пользователя, используя новое API (обращаемся непосредственно к сервису dialogs)
```
POST http://localhost:18081/dialog/{user_id}/send
{
    "text": "привет!"
}
```
Добавляем заголовок "token", в котором указываем токен, полученный в п.2

Вместо {user_id} подставляем ID добавленного в п 3.

## Сквозное логирование
В пункре 4 можно добавить заголовок "log_id", его значение будет ИД сквозного логирования. Если не добавлять, то он сгенерируется там автоматически. В логах main и dialogs будет видно идентификаторо сквозного логирования.
